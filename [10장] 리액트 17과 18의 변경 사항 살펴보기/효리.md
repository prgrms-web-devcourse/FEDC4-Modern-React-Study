🔗 [노션 링크](https://artistic-roadrunner-94f.notion.site/10-17-18-c108ab77dc164de7a8b767594ca298f4?pvs=4)

(1) 10.1 추가

---

# 리액트 딥다이브 10장 - 리액트 17과 18의 변경 사항 살펴보기

태그: React
날짜: 2024년 2월 6일

# 리액트 17과 18의 변경 사항 살펴보기

- 상위 천만 개의 사이트 중 리액트를 사용하고 있는 사이트의 반 이상이 16버전을 사용하고 있다.
- 에어비앤비, 넷플릭스 등 유명한 웹사이트들도 16버전을 사용한다고 한다. (22년 8월 기준)
- 하지만 17, 18 버전을 이해하고 있어야 한다.

---

## 10.1 리액트 17 버전 살펴보기

- 리액트 17 버전은 16 버전과 다르게 **새로 추가된 기능이 없다.**
  - 10만 개 이상의 컴포넌트 중 호환성이 깨지는 변경 사항에 영향을 받은 것은 20개 미만이다.
  - 따라서 16에서 17로 업그레이드 하는 것은 큰 부담 없이 할 수 있는 작업이다.

### 10.1.1 리액트의 점진적인 업그레이드

- 리액트도 유의적 버전 전략에 맞춰 버전을 업데이트 하고 있었다.
  - 주: 1.0.0 ⇒ 2.0.0 으로 업데이트, 호환되지 않는 API 업데이트 할 경우
  - 부: 1.0.0 ⇒ 1.1.0 으로 업데이트, 새로운 기능 추가할 경우
  - 수: 1.0.0 ⇒ 1.0.1 으로 업데이트, 버그 수정할 경우
- 예를 들어, 16 버전으로 업데이트할 경우 이전 버전에서의 API 제공을 완전히 중단해버리고 전체 앱을 새롭게 업그레이드하기를 요구했었다.
- **그러나 17부터는 점진적인 업그레이드가 가능해졌다.**
  - 주 버전이 업그레이드 되면 개발자는 어떤 API 수정이 있는지 확인해야 한다.
  - 중단된 API를 어떻게 고쳐야 할지 파악해야 한다.
  - 따라서 레거시 버전에 머물러야 할지, 새 버전으로 완전히 넘어가야 할지 선택의 기로에 놓여야 했다.
  - 하지만 점진적 업그레이드는 이전 버전과 새 버전을 함께 사용할 수 있다.

**16, 17 버전을 동시에 쓰는 예제**

[](https://github.com/wikibook/react-deep-dive-example/tree/main/chapter10/react-gradual-demo)

- 리액트 팀에서는 한꺼번에 업그레이드 하는 것을 권장한다.
- 점진적 업그레이드는 대규모 앱에서 한꺼번에 업그레이드 하기 부담스러울 때 시도해볼만 하다.

### 10.1.2 이벤트 위임 방식의 변경

```tsx
import { useEffect, useRef } from "react";

export default function Button() {
  const buttonRef = useRef<HTMLButtonElement | null>(null);

  useEffect(() => {
    if (buttonRef.current) {
      buttonRef.current.onclick = function click() {
        alert("안녕하세요!");
      };
    }
  }, []);

  function 안녕하세요() {
    alert("안녕하세요!");
  }

  return (
    <>
      <button onclick={안녕하세요}>리액트 버튼</button>
      <button ref={buttonRef}>그냥 버튼</button>
    </>
  );
}
```

- ‘리액트 버튼’은 리액트 앱에서 DOM에 이벤트를 추가한다.
  - 해당 버튼에 **noop**이라는 핸들러가 추가되어 있다.
- ‘그냥 버튼’은 직접 DOM을 참조해서 DOM의 onclick에 직접 함수를 추가하는 고전적인 방법을 사용한다.

  - 해당 버튼의 이벤트 리스너에 click으로 추가가 되어 있다.

- noop(no operation)은 말 그대로 아무런 일도 하지 않는다.
- 하지만 두 버튼 모두 동일한 작동을 한다. ‘리액트 버튼’이 작동하는 원리는 뭘까?

- 리액트는 이벤트 핸들러를 각각의 DOM 요소에 부탁하는 게 아니라, 이벤트 타입 당 하나의 핸들러를 루트에 부착한다. 이벤트 위임을 활용하는 것이다.
  - 16 버전에서는 이벤트 위임이 루트가 아닌 document에서 수행되었다.
    - 하위 컴포넌트에서 stopPropagation으로 상위로의 이벤트 전파를 막을 수 없다.
    - document와 루트 컴포넌트 사이에 이벤트를 막으면 리액트의 모든 핸들러가 작동하지 않는다.
  - 17 버전에서는 리액트 컴포넌트 최상단 트리인 루트 요소로 바뀌었다.

### 10.1.3 import React from ‘react’가 더 이상 필요 없다: 새로운 JSX transform

- JSX는 브라우저가 이해할 수 있는 코드가 아니므로 바벨이나 TS를 활용해 JS로 변환하는 과정이 꼭 필요하다.
- 16 버전까지는 코드 내에서 React를 사용하지 않더라도 JSX 변환 과정에서 import React from ‘react’가 필요했다.
- 17 버전부터는 바벨과 협력해 React를 import 하지 않아도 JSX 변환이 가능해졌다.

```tsx
// 16
var Component = React.createElement(
  "div",
  null,
  React.createElement("span", null, "hello world")
);

// 17
("use strict");

var _jsxRuntime = require("react/jsx-runtime");

var Component = (0, _jsxRuntime.jsx)("div", {
  children: (0, _jsxRuntime.jsx)("span", {
    children: "hello world",
  }),
});
```

- 17의 장점
  - React를 사용하지 않는다.
  - 내부로직이 더 간결하다.

### 10.1.4 그 밖의 주요 변경 사항

- 이벤트 폴링을 제거했다.
  - SyntheticEvent 풀을 만들어서 이벤트가 발생할 때마다 가져왔다.
  - 하지만 이벤트가 종료되자마자 바로 null로 초기화하기 때문에 사용하는 쪽에서 번거로웠다.
  - 비동기 코드 내부에서 이벤트에 접근하기 위해서는 e.persist() 같은 처리가 필요했다.
- useEffect 클린업 함수가 동기에서 비동기적 실행으로 변경됐다.
  - 16에서는 클린업 함수가 완료되기 전까지는 다른 작업이 불가능했다.
  - 17에서는 화면이 완전히 업데이트 된 후(커밋 단계가 완료된 후)에 비동기적으로 실행된다.
- 컴포넌트 undefined 반환에 에러를 띄우게 변경했다.

- **17.0.0 전체 변경 사항**
  ### React
  - 새로운 JSX 변환을 위해 react/jsx-runtime 및 react/jsx-dev-runtime 추가. (@lunaruan in #18299)
  - 네이티브 에러 프레임에서 컴포넌트 스택 빌드. (@sebmarkbage in #18561)
  - 개선된 스택을 위해 컨텍스트에 displayName 지정 가능. (@eps1lon in #18224)
  - UMD 번들에서 'use strict' 누출 방지. (@koba04 in #19614)
  - 리다이렉트를 위해 fb.me 사용 중단. (@cylim in #19598)
  ### React DOM
  - 문서 대신 루트에 이벤트 위임. (@trueadm in #18195 및 기타)
  - 다음 이펙트를 실행하기 전에 모든 이펙트 정리. (@bvaughn in #17947)
  - useEffect 정리 함수를 비동기적으로 실행. (@bvaughn in #17925)
  - onFocus 및 onBlur에 대해 브라우저 focusin 및 focusout 사용. (@trueadm in #19186)
  - 모든 캡처 이벤트가 브라우저 캡처 단계를 사용하도록 함. (@trueadm in #19221)
  - onScroll 이벤트의 버블링 모방 중지. (@gaearon in #19464)
  - forwardRef 또는 memo 컴포넌트가 undefined를 반환하면 예외 발생. (@gaearon in #19550)
  - 이벤트 풀링 제거. (@trueadm in #18969)
  - React Native Web에서 필요하지 않은 내부 노출 중지. (@necolas in #18483)
  - 루트가 마운트될 때 모든 알려진 이벤트 리스너를 첨부. (@gaearon in #19659)
  - DEV 모드 더블 렌더링의 두 번째 렌더 패스에서 콘솔 비활성화. (@sebmarkbage in #18547)
  - 문서화되지 않은 ReactTestUtils.SimulateNative API를 사용하지 않음을 경고. (@gaearon in #13407)
  - 내부에서 사용되는 private 필드 이름을 변경. (@gaearon in #18377)
  - 개발 중에 User Timing API 호출 중지. (@gaearon in #18417)
  - Strict Mode에서 반복 렌더링 중에 콘솔 비활성화. (@sebmarkbage in #18547)
  - Strict Mode에서 Hooks 없이도 더블 렌더링되는 컴포넌트. (@eps1lon in #18430)
  - 라이프사이클 메서드에서 ReactDOM.flushSync 호출 허용 (경고). (@sebmarkbage in #18759)
  - 키보드 이벤트 개체에 code 속성 추가. (@bl00mber in #18287)
  - 비디오 엘리먼트를 위한 disableRemotePlayback 속성 추가. (@tombrowndev in #18619)
  - 입력 엘리먼트를 위한 enterKeyHint 속성 추가. (@eps1lon in #18634)
  - <Context.Provider>에 값이 제공되지 않은 경우 경고. (@charlie1404 in #19054)
  - 잘못된 업데이트에 대한 에러 메시지 개선. (@JoviDeCroock in #18316)
  - 스택 프레임에서 forwardRef 및 memo 제외. (@sebmarkbage in #18559)
  - 제어 및 비제어 입력 간 전환 시 에러 메시지 개선. (@vcarl in #17070)
  - onTouchStart, onTouchMove 및 onWheel을 passive 상태로 유지. (@gaearon in #19654)
  - 개발 환경에서 닫힌 iframe 내에서 setState가 매달리는 문제 해결. (@gaearon in #19220)
  - defaultProps가 있는 lazy 컴포넌트에 대한 렌더링 방지 수정. (@jddxf in #18539)
  - dangerouslySetInnerHTML이 undefined일 때 잘못된 경고 수정. (@eps1lon in #18676)
  - 비표준 require 구현과 함께 Test Utils 수정. (@just-boris in #18632)
  - onBeforeInput이 잘못된 event.type을 보고하는 버그 수정. (@eps1lon in #19561)
  - Firefox에서 event.relatedTarget이 undefined로 보고되는 버그 수정. (@claytercek in #19607)
  - IE11에서 "unspecified error" 수정. (@hemakshis in #19664)
  - shadow root로 렌더링 수정. (@Jack-Works in #15894)
  - 캡처 이벤트와 함께 movementX/Y 폴리필 수정. (@gaearon in #19672)
  - onSubmit 및 onReset 이벤트에 대해 위임 사용. (@gaearon in #19333)
  - 메모리 사용 개선. (@trueadm in #18970)
  ### React DOM Server
  - 서버 렌더러를 위한 useCallback 동작을 useMemo와 일관되게 수정. (@alexmckenley in #18783)
  - 함수 컴포넌트가 throw할 때 상태 누수 수정. (@pmaccart in #19212)
  ### React Test Renderer
  - findByType 오류 메시지 개선. (@henryqdineen in #17439)
  ### Concurrent Mode (실험적)
  - 우선 순위 배치 휴리스틱을 개선. (@acdlite in #18796)
  - 실험적인 API 앞에 unstable\_ 접두사 추가. (@acdlite in #18825

---
